{% extends "base.html" %}

{% block title %}Combine Codes{% endblock %}

{% block head_scripts %}
<script src="https://js.stripe.com/v3/"></script>
<script>
    const STRIPE_PUBLISHABLE_KEY = '{{ stripe_publishable_key }}';
</script>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <h1 class="h5 card-title mb-4">GitHub Repository</h1>
                
                <form id="repository-form">
                    <div class="mb-4">
                        <label for="repo-url" class="form-label">Repository URL</label>
                        <div class="input-group">
                            <input type="url" 
                                   class="form-control" 
                                   id="repo-url" 
                                   name="repo-url" 
                                   placeholder="https://github.com/username/repository"
                                   required>
                            <button type="submit" 
                                    class="btn btn-primary"
                                    aria-label="Process files in selected directory">
                                <i class="bi bi-play-fill" aria-hidden="true"></i>
                                <span>Process Repository</span>
                            </button>
                        </div>
                        <div class="form-text d-flex justify-content-between align-items-center">
                            <span>Enter the HTTPS URL of the GitHub repository</span>
                            <button type="button" 
                                    class="btn btn-sm btn-outline-secondary" 
                                    onclick="document.getElementById('repo-url').value='https://github.com/gilzero/EditorDocAIAgentV1'">
                                <i class="bi bi-lightning-fill"></i> Quick Test
                            </button>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="github-token" class="form-label">GitHub Token (Optional)</label>
                        <input type="password" 
                               class="form-control" 
                               id="github-token" 
                               name="github-token" 
                               placeholder="For private repositories">
                        <div class="form-text">Required only for private repositories</div>
                    </div>

                    <div id="confirmation-area" class="mt-4"></div>
                    
                    <div id="progress-bar-container" style="width: 100%; background-color: #f3f3f3; display: none;">
                        <div id="progress-bar" style="width: 0%; height: 20px; background-color: #4caf50;"></div>
                    </div>
                    
                    <div id="result-area" class="mt-4"></div>
                    
                    <div id="error-area" class="mt-4"></div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block floating_elements %}
<div class="export-buttons d-none" id="exportButtons" role="group" aria-label="Export options">
    <button class="export-button" 
            onclick="exportAsImage()" 
            aria-label="Export statistics as image">
        <i class="bi bi-image" aria-hidden="true"></i>
        <span class="export-tooltip">Export as Image</span>
    </button>
    <button class="export-button" 
            onclick="exportAsPDF()" 
            aria-label="Export statistics as PDF">
        <i class="bi bi-file-pdf" aria-hidden="true"></i>
        <span class="export-tooltip">Export as PDF</span>
    </button>
</div>
{% endblock %}

{% block scripts %}
<script type="module">
    import { initializeTheme, initializeEventListeners, toggleTheme, handleRepositorySubmit } from '/static/js/main.js';
    
    // Make functions available globally
    window.toggleTheme = toggleTheme;
    window.handleRepositorySubmit = handleRepositorySubmit;
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        initializeTheme();
        initializeEventListeners();
    });
</script>
{% endblock %}
